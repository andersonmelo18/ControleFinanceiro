<!doctype html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Painel ‚Äî Controle Financeiro Aut√¥nomo</title>

    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        // Importa o SDK modular do Firestore (vers√£o 11.6.1, conforme seu script.js)
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Configura√ß√£o de fallback/obrigat√≥ria (usando o config original do usu√°rio)
        const FALLBACK_CONFIG = {
            apiKey: "AIzaSyBXCMMXEM-e_BNftJNcm6XeEGZ7KYPUiAY",
            authDomain: "controle-financeiro-b7880.firebaseapp.com",
            databaseURL: "https://controle-financeiro-b7880-default-rtdb.firebaseio.com",
            projectId: "controle-financeiro-b7880",
            storageBucket: "controle-financeiro-b7880.firebasestorage.app",
            messagingSenderId: "149823899793",
            appId: "1:149823899793:web:0fcdcd8ece6748697e9730"
        };

        let finalConfig = FALLBACK_CONFIG;

        // TENTA USAR A CONFIGURA√á√ÉO DO AMBIENTE, SEN√ÉO USA O FALLBACK (Garante projectId)
        if (typeof __firebase_config !== 'undefined' && __firebase_config) {
            try {
                const envConfig = JSON.parse(__firebase_config);
                finalConfig = { ...FALLBACK_CONFIG, ...envConfig };
            } catch (e) {
                console.warn("Erro ao parsear __firebase_config. Usando FALLBACK_CONFIG.");
            }
        }

        try {
            // Inicializa o App
            const app = initializeApp(finalConfig);
            // Inicializa o Firestore e exp√µe 'db' globalmente
            window.db = getFirestore(app);
            window.__app_id = finalConfig.appId;
            // Define um ID de usu√°rio mockado, pois o app n√£o tem Auth
            window.currentUserId = 'demo-user-123'; 
            console.log("Firebase Firestore inicializado.");
        } catch (error) {
            console.error("Erro ao inicializar o Firebase Firestore. Verifique a configura√ß√£o.", error);
        }
    </script>
</head>
<body>
    <div class="container">
        <div class="nav-tabs">
            <a href="index.html"><button class="tab-button active">üè† Painel</button></a>
            <a href="entradas.html"><button class="tab-button">‚û°Ô∏è Entradas</button></a>
            <a href="despesas.html"><button class="tab-button">‚¨ÖÔ∏è Despesas</button></a>
            <a href="fixos.html"><button class="tab-button">üìå Fixos/D√≠vidas</button></a>
            <a href="cartoes.html"><button class="tab-button">üí≥ Cart√µes</button></a>
        </div>

        <div id="dashboard-tab" class="tab-content" style="display:block">
            <div class="month-selector">
                <button onclick="changeMonth(-1)">&#9664;</button>
                <h2 id="current-month-display"></h2>
                <button onclick="changeMonth(1)">&#9654;</button>
            </div>

            <div class="dashboard-grid">
                <div id="total-entradas" class="card">
                    <h4>‚¨ÜÔ∏è Total Entradas</h4>
                    <div class="value">R$ 0,00</div>
                </div>
                <div id="total-despesas" class="card">
                    <h4>‚¨áÔ∏è Total Despesas</h4>
                    <div class="value">R$ 0,00</div>
                </div>
                <div id="lucro-liquido" class="card full-width">
                    <h4>üéØ Lucro L√≠quido</h4>
                    <div class="value">R$ 0,00</div>
                </div>
                <div id="saldo-caixa" class="card full-width">
                    <h4>üóÉÔ∏è Saldo em Caixa (Dinheiro/PIX)</h4>
                    <div class="value">R$ 0,00</div>
                    <p class="small" style="margin:5px 0 0"></p>
                </div>
                <div class="card">
                    <h4>Km Total</h4>
                    <div id="total-km" class="value">0 km</div>
                </div>
                <div class="card">
                    <h4>Horas Total</h4>
                    <div id="total-hours" class="value">0 h</div>
                </div>
            </div>

            <div class="card-control-section">
                <h3>üìå Detalhamento de Despesas (Geral)</h3>
                <div class="card-item"><span>Despesas Vari√°veis</span><span id="var-exp-value" style="font-weight:bold;color:var(--cor-erro)">R$ 0,00</span></div>
                <div class="card-item"><span>Despesas Fixas e D√≠vidas</span><span id="fix-exp-value" style="font-weight:bold;color:var(--cor-erro)">R$ 0,00</span></div>
            </div>

            <div style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;">
                <button id="export-csv-btn" class="submit-btn">Exportar CSV (Excel)</button>
                <button id="export-pdf-btn" class="submit-btn">Exportar PDF</button>
            </div>

            <div style="display:flex; gap:12px; margin-top:12px; flex-direction:column;">
                <div class="card" style="min-height:260px;">
                    <h4>Gr√°fico ‚Äî Receitas vs Despesas</h4>
                    <div style="height:200px;"><canvas id="chart-donut"></canvas></div>
                </div>

                <div class="card" style="min-height:260px;">
                    <h4>Gastos por Categoria</h4>
                    <div style="height:220px"><canvas id="chart-bar"></canvas></div>
                </div>

                <div class="card">
                    <h4>Resumo Mensal</h4>
                    <div id="monthly-summary-table"></div>
                </div>
            </div>
        </div>

    </div>

    <script src="script.js"></script>
</body>
</html>